<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2196F3">
    <meta name="description" content="FC 25 Score Tracker - Track your football match scores and statistics">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FC 25 Score Tracker</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // #region agent log
        (function () {
            const endpoint = 'http://127.0.0.1:7249/ingest/12f9232d-c1a6-4b9d-9176-f23ba151eb7a';
            const sessionId = 'debug-session';
            const runId = 'pre-fix';
            const hypothesisId = 'H-global';
            function send(payload) {
                try {
                    fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(Object.assign({
                            sessionId,
                            runId,
                            hypothesisId,
                            timestamp: Date.now()
                        }, payload))
                    }).catch(() => {});
                } catch (e) {
                    console && console.warn && console.warn('log send failed', e);
                }
            }
            window.addEventListener('error', function (e) {
                send({
                    location: 'index.html:onerror',
                    message: 'window error',
                    data: {
                        message: e.message,
                        filename: e.filename,
                        lineno: e.lineno,
                        colno: e.colno
                    }
                });
            });
            window.addEventListener('unhandledrejection', function (e) {
                send({
                    location: 'index.html:onunhandledrejection',
                    message: 'unhandled rejection',
                    data: {
                        reason: e && e.reason ? String(e.reason) : 'unknown'
                    }
                });
            });
            send({ location: 'index.html:boot', message: 'page start' });
        })();
        // #endregion
    </script>
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>
    <div id="byDatePanel" class="by-date-panel" style="display: none;">
        <div class="by-date-modal" style="background: var(--card-bg, #fff); padding: 1rem; border-radius: 12px; width: min(420px, 92vw); box-shadow: 0 12px 32px rgba(0,0,0,0.2); display: flex; flex-direction: column; gap: 0.75rem;">
            <div class="by-date-header" style="display: flex; align-items: center; justify-content: space-between; gap: 0.5rem;">
                <h3 style="margin: 0;">Select Dates</h3>
                <button id="closeByDatePanel" class="btn btn-secondary" style="padding: 0.3rem 0.65rem;">‚úï</button>
            </div>
            <div class="by-date-content" style="display: flex; flex-direction: column; gap: 0.75rem;">
                <div class="by-date-range" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 0.5rem;">
                    <label class="date-field">
                        <span class="date-label">üìÖ From</span>
                        <input type="date" id="byDateFrom" class="date-input" title="From Date">
                    </label>
                    <label class="date-field">
                        <span class="date-label">üìÖ To</span>
                        <input type="date" id="byDateTo" class="date-input" title="To Date">
                    </label>
                </div>
                <div id="byDateList" class="by-date-list"></div>
            </div>
            <div class="by-date-actions" style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                <button id="clearByDateBtn" class="btn btn-secondary" style="padding: 0.5rem 0.9rem;">Clear</button>
                <button id="applyByDateBtn" class="btn btn-primary" style="padding: 0.5rem 0.9rem;">Apply</button>
            </div>
        </div>
    </div>
    <!-- Header -->
    <header class="app-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>FC 25 Score Tracker</h1>
            <div style="display: flex; gap: 0.5rem;">
                <button id="goToSessionBtn" class="btn btn-secondary" style="display:none; padding: 0.4rem 0.7rem; font-size: 0.9rem;" title="Back to Session">Session</button>
                <button id="refreshAppBtn" class="dark-mode-toggle" title="Check for Updates" style="font-size: 1rem;">üîÑ</button>
                <button id="darkModeToggle" class="dark-mode-toggle" title="Toggle Dark Mode">üåô</button>
            </div>
        </div>
        <div style="background: #4CAF50; color: white; padding: 0.5rem 1rem; border-radius: 8px; margin: 0.5rem 0; text-align: center; font-weight: bold; font-size: 0.9rem;">
            <span id="appVersionBanner">Loading version‚Ä¶</span>
        </div>
        <div class="season-info" id="seasonInfo" style="display: none;">
            <span>Season <span id="currentSeasonNumber">1</span></span>
        </div>
    </header>

    <!-- Session Wizard Screen -->
    <section id="sessionScreen" class="screen active">
        <div class="screen-content">
            <!-- Session Splash (default) -->
            <div id="sessionSplash" class="session-splash">
                <div class="session-splash-inner">
                    <h2>Session</h2>
                    <p class="screen-description">Tap Start to begin a guided session</p>
                    <button id="sessionStartBtn" class="btn btn-primary session-start-btn">Start</button>
                </div>
                <a href="#" id="sessionAdvancedModeBtn" class="session-advanced-link">Advanced</a>
            </div>

            <!-- Stepper Header -->
            <div class="session-stepper" id="sessionStepper" style="display:none;">
                <div class="step-indicator" data-step="players">
                    <div class="step-number">1</div>
                    <div class="step-label">Players</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="teams">
                    <div class="step-number">2</div>
                    <div class="step-label">Teams</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="match">
                    <div class="step-number">3</div>
                    <div class="step-label">Match</div>
                </div>
            </div>

            <!-- Step Content -->
            <div class="session-step-content" id="sessionWizardContent" style="display:none;">
                <!-- Step 1: Players -->
                <div class="session-step" data-step="players" style="display: block;">
                    <h2>Add Players</h2>
                    <p class="screen-description">Enter player names to start your session</p>

                    <div class="session-player-editor">
                        <div class="session-player-list" id="sessionPlayerList">
                            <!-- Dynamic player inputs will be added here -->
                        </div>
                        <div class="session-player-actions">
                            <button id="sessionAddPlayerBtn" class="btn btn-secondary btn-small">+ Add Player</button>
                            <button id="startNewSessionBtn" class="btn btn-secondary btn-small">Start New Session</button>
                        </div>
                    </div>

                    <div class="session-validation" id="sessionPlayersValidation" style="display: none;">
                        <p class="validation-error">Please add at least 2 players to continue</p>
                    </div>
                </div>

                <!-- Step 2: Teams -->
                <div class="session-step" data-step="teams" style="display: none;">
                    <h2>Choose Teams</h2>
                    <p class="screen-description">Select how you want to play</p>

                    <div class="session-team-options" id="sessionTeamOptions">
                        <!-- Team structure options will be populated here -->
                    </div>

                    <div class="session-selected-teams" id="sessionSelectedTeams" style="display: none;">
                        <h3>Selected Matches</h3>
                        <div id="sessionMatchPreview" class="session-match-preview"></div>
                    </div>
                </div>

                <!-- Step 3: Match -->
                <div class="session-step" data-step="match" style="display: none;">
                    <h2>Record Match</h2>
                    <p class="screen-description">Enter the final score</p>

                    <div class="session-current-match" id="sessionCurrentMatch">
                        <!-- Current match display will be populated here -->
                    </div>

                    <div class="session-next-match-cta" id="sessionNextMatchCTA" style="display: none;">
                        <h3>Match Complete!</h3>
                        <p>Ready for the next match?</p>
                        <button id="sessionNextMatchBtn" class="btn btn-primary">Next Match</button>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="session-actions" id="sessionWizardActions" style="display:none;">
                <a href="#" id="sessionAdvancedLink" class="session-advanced-link">Advanced Options</a>
                <button id="sessionContinueBtn" class="btn btn-primary session-continue-btn">Continue</button>
            </div>
        </div>
    </section>

    <!-- Player Management Screen -->
    <section id="playerScreen" class="screen">
        <div class="screen-content">
            <h2>Add Players</h2>
            <p class="screen-description">Enter 1-4 player names to get started. Use the "Present/Absent" toggle to mark players who can't make it - their individual stats will freeze while their teams continue earning points.</p>
            
            <div class="player-editor">
                <div class="player-editor-header">
                    <div>
                        <h3>Players</h3>
                        <p class="screen-description">Tap a name to edit. Drag to reorder. Max 4 players.</p>
                    </div>
                    <div class="player-header-actions">
                        <button id="addPlayerBtn" class="btn btn-secondary">Add Player</button>
                        <button id="savePlayersBtn" class="btn btn-primary">Save Players</button>
                        <button id="startNewSessionBtn" class="btn btn-secondary">Start New Session</button>
                    </div>
                </div>
                <ul id="playerEditableList" class="player-editable-list"></ul>
            </div>

            <div class="current-players" id="currentPlayers" style="display: none;">
                <h3>Current Players</h3>
                <ul id="playersList"></ul>
            </div>

            <!-- Add this new section after current-players -->
            <div class="player-history" id="playerHistory" style="display: none;">
                <h3>Previous Players</h3>
                <p class="screen-description">Click a name to add to an empty slot</p>
                <div id="playerHistoryList" class="player-history-list"></div>
            </div>

            <div class="player-lock" id="playerLockContainer" style="display: none;">
                <h3>Home/Away Lock</h3>
                <p class="screen-description">Choose one player to always appear on Home or Away.</p>
                <div id="playerLockList" class="player-lock-list"></div>
                <p class="player-lock-hint" id="playerLockHint" style="display: none;">Set the locked player to Neutral before selecting someone else.</p>
                <p class="player-lock-hint" id="playerLockUnsavedHint" style="display: none;">Save player changes to update lock options.</p>
            </div>

        </div>
    </section>

    <!-- Team Combination Screen -->
    <section id="teamScreen" class="screen">
        <div class="screen-content">
            <h2>Team Combinations</h2>
            <div class="button-group" style="margin-bottom: 0.5rem;">
                <button id="randomCombinationBtn" class="btn btn-secondary">Randomize Order</button>
            </div>
            <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem; cursor: pointer;">
                <input type="checkbox" id="useRandomTeamsCheckbox" class="checkbox-input">
                <span>Use random team names from synced list</span>
            </label>
            <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem; margin-left: 1.5rem; cursor: pointer;">
                <input type="checkbox" id="useSameTeamNameCheckbox" class="checkbox-input">
                <span>Use one club for every round (same club for all matches)</span>
            </label>
            <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem; margin-left: 1.5rem; cursor: pointer;">
                <input type="checkbox" id="useSameTeamPerRoundCheckbox" class="checkbox-input">
                <span>Same team per round (e.g. Round 1: Newcastle vs Newcastle, Round 2: Liverpool vs Liverpool)</span>
            </label>
            <p class="screen-description" id="teamSameClubHint" style="margin-left: 1.5rem; margin-top: 0; margin-bottom: 0.5rem; font-size: 0.85rem;">Leave unchecked for a different club each round. If you see the same club every round, uncheck this and click Confirm Sequence again.</p>
            <div class="settings-section" style="margin-top: 1rem; margin-bottom: 0.75rem;">
                <h3 style="margin: 0 0 0.25rem 0; font-size: 1rem;">Leagues to sync</h3>
                <p class="screen-description" style="margin: 0 0 0.5rem 0; font-size: 0.85rem;">Choose leagues; Sync fetches the top N from each.</p>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                    <button type="button" id="leaguePresetTop4" class="btn btn-secondary" style="padding: 0.35rem 0.5rem; font-size: 0.85rem;">Top 4</button>
                    <button type="button" id="leaguePresetTop6Europe" class="btn btn-secondary" style="padding: 0.35rem 0.5rem; font-size: 0.85rem;">Top 6 Europe</button>
                    <button type="button" id="leaguePresetWorldMix" class="btn btn-secondary" style="padding: 0.35rem 0.5rem; font-size: 0.85rem;">World mix</button>
                    <button type="button" id="leaguePresetInternational" class="btn btn-secondary" style="padding: 0.35rem 0.5rem; font-size: 0.85rem;">International</button>
                </div>
                <div id="leaguesToSyncCheckboxes" style="display: flex; flex-wrap: wrap; gap: 0.5rem 1rem;"></div>
            </div>
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.25rem; flex-wrap: wrap;">
                <button type="button" id="syncTopTeamsBtn" class="btn btn-secondary" title="Fetch teams from selected leagues">Sync Top Teams</button>
                <span style="display: flex; align-items: center; gap: 0.35rem; font-size: 0.9rem;">
                    <label for="teamsPerLeagueInput" style="white-space: nowrap;">Teams per league:</label>
                    <input type="number" id="teamsPerLeagueInput" min="1" max="20" value="5" style="width: 3.5rem; padding: 0.35rem; font-size: 1rem;" title="Number of teams to download from each league (1‚Äì20)" aria-label="Teams per league">
                </span>
                <button type="button" id="viewSyncedTeamsListBtn" class="btn btn-secondary" title="View the list of team names from sync">View list</button>
                <span id="teamNamesLoadedCount" class="screen-description" style="display: none;"></span>
            </div>
            <p class="screen-description" style="margin-top: 0; margin-bottom: 1rem; font-size: 0.85rem; color: #666;">Sync downloads club names from the leagues you selected (top N per league); they are used when you randomise.</p>
            <p class="screen-description" id="teamScreenDescription">Select the order you want to play these matches</p>
            
            <div id="teamCombinations" class="team-combinations-grid"></div>
            
            <div class="button-group">
                <button id="selectAllCombinationsBtn" class="btn btn-secondary">Select All</button>
                <button id="confirmSequenceBtn" class="btn btn-primary" disabled>Confirm Sequence</button>
                <button id="backToPlayersBtn" class="btn btn-secondary">Back to Players</button>
            </div>
        </div>
    </section>

    <!-- Game Sequence Screen -->
    <section id="sequenceScreen" class="screen">
        <div class="screen-content">
            <h2>Game Sequence</h2>
            <p class="screen-description">Your selected matches for tonight</p>
            
            <div id="sequenceList" class="sequence-list"></div>
            
            <div class="button-group">
                <button id="startGamesBtn" class="btn btn-primary">Start Playing</button>
                <button id="backToTeamsBtn" class="btn btn-secondary">Back to Teams</button>
            </div>
        </div>
    </section>

    <!-- Match Recording Screen -->
    <section id="matchScreen" class="screen">
        <div class="screen-content">
            <h2>Record Match</h2>
            <div class="match-info">
                <div class="game-counter">
                    <span id="currentGameNumber">1</span> / <span id="totalGames">1</span>
                </div>
                <div class="match-teams" id="matchTeams">
                    <div class="team-display">
                        <div class="team-players" id="team1Display"></div>
                        <span class="vs">VS</span>
                        <div class="team-players" id="team2Display"></div>
                    </div>
                </div>
            </div>

            <div class="match-result">
                <h3>Enter Scores</h3>
                <div class="score-input-container">
                    <div class="score-input-group">
                        <label id="team1ScoreLabel" for="team1Score">Team 1 Score</label>
                        <input type="number" id="team1Score" min="0" max="99" value="0" class="score-input">
                    </div>
                    <span class="score-separator">-</span>
                    <div class="score-input-group">
                        <label id="team2ScoreLabel" for="team2Score">Team 2 Score</label>
                        <input type="number" id="team2Score" min="0" max="99" value="0" class="score-input">
                    </div>
                </div>
                
                <!-- Extra Time Section -->
                <div class="extra-time-section" id="extraTimeSection" style="display: none; margin-top: 1rem;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="wentToExtraTime" class="checkbox-input">
                        <span>Went to Extra Time</span>
                    </label>
                    <p class="score-hint" style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0.5rem;">Enter the total score after extra time (full time + extra time goals)</p>
                    <div class="score-input-container" id="extraTimeScores" style="display: none; margin-top: 0.75rem;">
                        <div class="score-input-group">
                            <label for="team1ExtraTimeScore">Team 1 (Total)</label>
                            <input type="number" id="team1ExtraTimeScore" min="0" max="99" value="0" class="score-input">
                        </div>
                        <span class="score-separator">-</span>
                        <div class="score-input-group">
                            <label for="team2ExtraTimeScore">Team 2 (Total)</label>
                            <input type="number" id="team2ExtraTimeScore" min="0" max="99" value="0" class="score-input">
                        </div>
                    </div>
                </div>
                
                <!-- Penalties Section -->
                <div class="penalties-section" id="penaltiesSection" style="display: none; margin-top: 1rem;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="wentToPenalties" class="checkbox-input">
                        <span>Went to Penalties</span>
                    </label>
                    <p class="score-hint" style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0.5rem;">Enter only the penalties scored (e.g., 5-4)</p>
                    <div class="score-input-container" id="penaltiesScores" style="display: none; margin-top: 0.75rem;">
                        <div class="score-input-group">
                            <label for="team1PenaltiesScore">Team 1 (Pens)</label>
                            <input type="number" id="team1PenaltiesScore" min="0" max="20" value="0" class="score-input">
                        </div>
                        <span class="score-separator">-</span>
                        <div class="score-input-group">
                            <label for="team2PenaltiesScore">Team 2 (Pens)</label>
                            <input type="number" id="team2PenaltiesScore" min="0" max="20" value="0" class="score-input">
                        </div>
                    </div>
                </div>
                
                <button id="submitScoreBtn" class="btn btn-primary" style="margin-top: 1rem;">Record Score</button>
                <button id="undoLastMatchBtn" class="btn btn-secondary" style="margin-top: 0.5rem;">Undo Last Match</button>
            </div>

            <div class="button-group">
                <button id="backToSequenceBtn" class="btn btn-secondary">Back to Sequence</button>
            </div>
        </div>
    </section>

    <!-- Statistics Screen -->
    <section id="statsScreen" class="screen">
        <div class="screen-content">
            <div class="stats-header">
                <h2>Statistics</h2>
                <div class="stats-tabs">
                    <label for="statsTabSelect" style="font-size: 0.9rem; margin-right: 0.35rem;">View:</label>
                    <select id="statsTabSelect" class="settings-input" style="min-width: 140px;">
                        <option value="today" selected>Today</option>
                        <option value="season">Season</option>
                        <option value="overall">Overall</option>
                    </select>
                </div>
                    <div class="stats-mode-toggle" style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                        <button class="mode-btn active" data-mode="raw" title="Show raw totals">Raw</button>
                        <button class="mode-btn" data-mode="perGame" title="Show per-game rates">Per Game</button>
                        <button class="mode-btn" data-mode="projected" title="Scale to max games played">Projected</button>
                    </div>
                <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 0.5rem; align-items: center;">
                    <button id="byDateStatsBtn" class="btn btn-secondary" style="padding: 0.35rem 0.75rem;">By Date</button>
                    <button id="viewLastPDFBtn" class="btn btn-secondary" title="View Last Exported PDF" disabled style="opacity: 0.5; cursor: not-allowed;">üëÅÔ∏è View PDF</button>
                </div>
            </div>

            <div id="todayStats" class="stats-content active">
                <div class="stats-header-actions">
                    <h3>Today's Statistics</h3>
                    <div class="share-buttons-group">
                        <button id="shareTodayStatsBtn" class="btn btn-share" title="Share as Image">üì§ Share</button>
                        <button id="exportTodayPDFBtn" class="btn btn-share" title="Export as PDF">üìÑ PDF</button>
                    </div>
                </div>
                <div class="category-tabs" id="todayCategoryTabs"></div>
                <div id="todayStatsDisplay" class="stats-display"></div>
            </div>

            <div id="seasonStats" class="stats-content">
                <div class="stats-header-actions">
                    <h3>Season Statistics</h3>
                    <div class="share-buttons-group">
                        <button id="shareSeasonStatsBtn" class="btn btn-share" title="Share as Image">üì§ Share</button>
                        <button id="exportSeasonPDFBtn" class="btn btn-share" title="Export as PDF">üìÑ PDF</button>
                    </div>
                </div>
                <div class="category-tabs" id="seasonCategoryTabs"></div>
                <div id="seasonStatsDisplay" class="stats-display"></div>
            </div>

            <div id="overallStats" class="stats-content">
                <div class="stats-header-actions">
                    <h3>Overall Statistics</h3>
                    <div class="share-buttons-group">
                        <button id="shareOverallStatsBtn" class="btn btn-share" title="Share as Image">üì§ Share</button>
                        <button id="exportOverallPDFBtn" class="btn btn-share" title="Export as PDF">üìÑ PDF</button>
                    </div>
                </div>
                <div class="category-tabs" id="overallCategoryTabs"></div>
                <div id="overallStatsDisplay" class="stats-display"></div>
            </div>

            <div id="customStats" class="stats-content" style="display: none;">
                <div class="stats-header-actions">
                    <h3>Custom Statistics</h3>
                    <div class="share-buttons-group">
                        <button id="shareCustomStatsBtn" class="btn btn-share" title="Share as Image">üì§ Share</button>
                        <button id="exportCustomPDFBtn" class="btn btn-share" title="Export as PDF">üìÑ PDF</button>
                    </div>
                </div>
                <p id="customFilterSummary" class="screen-description" style="margin-bottom: 0.75rem;">
                    Select a date from the By Date panel to view custom stats.
                </p>
                <div class="category-tabs" id="customCategoryTabs"></div>
                <div id="customStatsDisplay" class="stats-display"></div>
            </div>

            <div class="button-group">
                <button id="newSeasonBtn" class="btn btn-primary">Start New Season</button>
                <button id="exportDataBtn" class="btn btn-secondary">Export Data</button>
                <button id="importDataBtn" class="btn btn-secondary">Import Data</button>
                <button id="clearOverallStatsBtn" class="btn btn-secondary" style="background-color: #f44336;">Clear All Statistics (Testing)</button>
                <button id="backToMenuBtn" class="btn btn-secondary">Back to Menu</button>
            </div>
        </div>
    </section>

    <!-- Match History Screen -->
    <section id="historyScreen" class="screen">
        <div class="screen-content">
            <h2>Match History</h2>
            <p class="screen-description">View and manage all recorded matches</p>
            
            <div class="history-view-toggle">
                <button id="historyListViewBtn" class="view-toggle-btn active" data-view="list">üìã List</button>
                <button id="historyTimelineViewBtn" class="view-toggle-btn" data-view="timeline">üìÖ Timeline</button>
            </div>

            <div class="history-quick-filters" style="display: flex; gap: 0.5rem; margin: 0.5rem 0;">
                <button class="view-toggle-btn history-quick-btn active" data-filter="all">All</button>
                <button class="view-toggle-btn history-quick-btn" data-filter="current">This season</button>
                <button class="view-toggle-btn history-quick-btn" data-filter="today">Today</button>
            </div>

            <button id="historyFiltersToggle" class="filters-toggle" aria-expanded="true">More filters ‚ñæ</button>

            <div id="historyControlsWrapper" class="history-controls">
                <select id="historyFilter" class="filter-select">
                    <option value="all">All seasons</option>
                    <option value="current">Current</option>
                    <option value="today">Today</option>
                </select>
                <select id="historySortOrder" class="filter-select" title="Sort order">
                    <option value="desc">‚ñº Last played</option>
                    <option value="asc">‚ñ≤ First played</option>
                </select>
                <label class="date-field">
                    <span class="date-label">üìÖ From</span>
                    <input type="date" id="historyDateFrom" class="date-input" title="From Date">
                </label>
                <label class="date-field">
                    <span class="date-label">üìÖ To</span>
                    <input type="date" id="historyDateTo" class="date-input" title="To Date">
                </label>
                <label for="historySearch" class="sr-only">Search players</label>
                <input type="text" id="historySearch" placeholder="Search players..." class="search-input">
                <button id="clearHistoryFiltersBtn" class="btn btn-secondary clear-btn" style="padding: 0.5rem 1rem; font-size: 0.85rem;">Clear</button>
            </div>
            
            <div id="matchHistoryList" class="match-history-list"></div>
            <div id="matchHistoryTimeline" class="match-history-timeline" style="display: none;"></div>
            
            <div class="button-group">
                <button id="backFromHistoryBtn" class="btn btn-secondary">Back</button>
            </div>
        </div>
    </section>

    <!-- Team Details Screen -->
    <section id="teamDetailsScreen" class="screen">
        <div class="screen-content">
            <h2 id="teamDetailsTitle">Team Details</h2>
            <p class="screen-description" id="teamDetailsSubtitle">Match history for this team</p>
            
            <div id="teamDetailsMatchList" class="team-details-match-list"></div>
            
            <div class="button-group">
                <button id="backFromTeamDetailsBtn" class="btn btn-secondary">Back</button>
            </div>
        </div>
    </section>

    <!-- Admin PIN Entry Modal -->
    <div id="adminPinModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <h3 id="adminPinModalTitle">Enter Admin PIN</h3>
            <p id="adminPinModalMessage" style="margin: 0.5rem 0 1rem 0; color: var(--text-secondary);">Please enter your 4-digit PIN to continue</p>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div>
                    <label for="adminPinModalInput" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">PIN</label>
                    <input type="password" id="adminPinModalInput" class="settings-input" placeholder="0000" maxlength="4" inputmode="numeric" pattern="[0-9]*" autocomplete="off" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>
                <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                    <button id="adminPinModalCancel" class="btn btn-secondary">Cancel</button>
                    <button id="adminPinModalSubmit" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Synced / uploaded teams list modal -->
    <div id="syncedTeamsListModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 480px;">
            <h3 id="syncedTeamsListModalTitle">Team names list</h3>
            <div id="syncedTeamsListBody" style="max-height: 60vh; overflow-y: auto; margin: 0.5rem 0 1rem 0; padding-right: 0.25rem;"></div>
            <div style="display: flex; justify-content: flex-end;">
                <button id="syncedTeamsListModalClose" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Match Modal -->
    <div id="editMatchModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Edit Match</h3>
            <div class="match-info">
                <div id="editMatchTeams"></div>
            </div>
            <div class="score-input-container">
                <div class="score-input-group">
                    <label for="editTeam1Score">Team 1 Score</label>
                    <input type="number" id="editTeam1Score" min="0" max="99" value="0" class="score-input">
                </div>
                <span class="score-separator">-</span>
                <div class="score-input-group">
                    <label for="editTeam2Score">Team 2 Score</label>
                    <input type="number" id="editTeam2Score" min="0" max="99" value="0" class="score-input">
                </div>
            </div>
            
            <!-- Extra Time Section -->
            <div class="extra-time-section" id="editExtraTimeSection" style="margin-top: 1rem;">
                <label class="checkbox-label">
                    <input type="checkbox" id="editWentToExtraTime" class="checkbox-input">
                    <span>Went to Extra Time</span>
                </label>
                <p class="score-hint" style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0.5rem;">Enter the total score after extra time (full time + extra time goals)</p>
                <div class="score-input-container" id="editExtraTimeScores" style="display: none; margin-top: 0.75rem;">
                        <div class="score-input-group">
                            <label for="editTeam1ExtraTimeScore">Team 1 (Total)</label>
                            <input type="number" id="editTeam1ExtraTimeScore" min="0" max="99" value="0" class="score-input">
                        </div>
                        <span class="score-separator">-</span>
                        <div class="score-input-group">
                            <label for="editTeam2ExtraTimeScore">Team 2 (Total)</label>
                            <input type="number" id="editTeam2ExtraTimeScore" min="0" max="99" value="0" class="score-input">
                        </div>
                </div>
            </div>
            
            <!-- Penalties Section -->
            <div class="penalties-section" id="editPenaltiesSection" style="margin-top: 1rem;">
                <label class="checkbox-label">
                    <input type="checkbox" id="editWentToPenalties" class="checkbox-input">
                    <span>Went to Penalties</span>
                </label>
                <p class="score-hint" style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0.5rem;">Enter only the penalties scored (e.g., 5-4)</p>
                <div class="score-input-container" id="editPenaltiesScores" style="display: none; margin-top: 0.75rem;">
                        <div class="score-input-group">
                            <label for="editTeam1PenaltiesScore">Team 1 (Pens)</label>
                            <input type="number" id="editTeam1PenaltiesScore" min="0" max="20" value="0" class="score-input">
                        </div>
                        <span class="score-separator">-</span>
                        <div class="score-input-group">
                            <label for="editTeam2PenaltiesScore">Team 2 (Pens)</label>
                            <input type="number" id="editTeam2PenaltiesScore" min="0" max="20" value="0" class="score-input">
                        </div>
                </div>
            </div>
            
            <div class="button-group">
                <button id="saveEditMatchBtn" class="btn btn-primary">Save Changes</button>
                <button id="cancelEditMatchBtn" class="btn btn-secondary">Cancel</button>
                <button id="deleteMatchBtn" class="btn btn-secondary" style="background-color: #f44336;">Delete Match</button>
            </div>
        </div>
    </div>


    <!-- Settings Screen -->
    <section id="settingsScreen" class="screen">
        <div class="screen-content">
            <h2>Settings</h2>
            <p class="screen-description">Customize your score tracker</p>
            
            <div class="settings-tabs">
                <button class="settings-tab-btn active" data-settings-tab="game">Game Config</button>
                <button class="settings-tab-btn" data-settings-tab="visual">Visual</button>
                <button class="settings-tab-btn" data-settings-tab="data">Data</button>
            </div>
            
            <!-- Game Configuration Tab -->
            <div id="gameConfigTab" class="settings-tab-content active">
                <div class="settings-section">
                    <h3>Team Labels</h3>
                    <p class="settings-description">Customize the labels used for team positions</p>
                    <div class="settings-group">
                        <label for="homeLabelInput">Home Label:</label>
                        <input type="text" id="homeLabelInput" placeholder="Home" maxlength="20" class="settings-input">
                    </div>
                    <div class="settings-group">
                        <label for="awayLabelInput">Away Label:</label>
                        <input type="text" id="awayLabelInput" placeholder="Away" maxlength="20" class="settings-input">
                    </div>
                    <div class="settings-group">
                        <label for="neutralLabelInput">Neutral Label:</label>
                        <input type="text" id="neutralLabelInput" placeholder="Neutral" maxlength="20" class="settings-input">
                    </div>
                    <button id="resetLabelsBtn" class="btn btn-secondary" style="margin-top: 1rem;">Reset to Default</button>
                </div>
                <div class="settings-section" style="margin-top: 2rem;">
                    <h3>Points System</h3>
                    <p class="settings-description">Set points awarded for match results. Changes apply to all league tables and statistics.</p>
                    <div class="settings-group">
                        <label for="pointsWinInput">Points for a Win:</label>
                        <input type="number" id="pointsWinInput" class="settings-input" step="0.1" inputmode="decimal" min="0" max="10">
                    </div>
                    <div class="settings-group">
                        <label for="pointsDrawInput">Points for a Draw:</label>
                        <input type="number" id="pointsDrawInput" class="settings-input" step="0.1" inputmode="decimal" min="0" max="10">
                    </div>
                    <div class="settings-group">
                        <label for="pointsLossInput">Points for a Loss:</label>
                        <input type="number" id="pointsLossInput" class="settings-input" step="0.1" inputmode="decimal" min="0" max="10">
                    </div>
                    <div class="settings-group" style="margin-top: 1rem; padding: 0.75rem; background: rgba(76, 175, 80, 0.1); border-radius: 6px;">
                        <p style="margin: 0; font-size: 0.9rem; color: #2e7d32; font-weight: 500;">
                            üí° <strong>Tip:</strong> Since you never have draws, set Draw points to 0 and Win points to 1 for a simple 1-0 points system.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Visual Settings Tab -->
            <div id="visualSettingsTab" class="settings-tab-content">
                <div class="settings-section">
                    <h3>Player Colors</h3>
                    <p class="settings-description">Assign colors to players for visual identification</p>
                    <div id="playerColorsList" class="player-colors-list"></div>
                </div>
                <div class="settings-section" style="margin-top: 2rem;">
                    <h3>Theme</h3>
                    <div class="settings-group">
                        <label>
                            <input type="checkbox" id="darkModeSetting" class="settings-checkbox">
                            Enable Dark Mode
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Data Management Tab -->
            <div id="dataSettingsTab" class="settings-tab-content">
                <div class="settings-section">
                    <h3>External Services</h3>
                    <p class="settings-description">API key for football-data.org (Live Team Sync). Get a free key at <a href="https://www.football-data.org/" target="_blank" rel="noopener">football-data.org</a></p>
                    <div class="settings-group">
                        <label for="apiKeyInput">Football Data API Key:</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="password" id="apiKeyInput" class="settings-input" placeholder="Enter your API key" autocomplete="off" style="flex: 1;">
                            <button id="saveApiKeyBtn" class="btn btn-primary" style="padding: 0.5rem;">Save Key</button>
                        </div>
                    </div>
                    <div class="settings-group" style="margin-top: 1rem;">
                        <label for="corsProxyKeyInput">CORS proxy key (for Sync on phone):</label>
                        <p class="settings-description" style="margin-top: 0.25rem;">Required for Sync Top Teams on mobile. Get a free key at <a href="https://cors.sh/" target="_blank" rel="noopener">cors.sh</a>, then paste it here and save.</p>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="password" id="corsProxyKeyInput" class="settings-input" placeholder="Optional ‚Äì paste cors.sh API key for mobile sync" autocomplete="off" style="flex: 1;">
                            <button id="saveCorsProxyKeyBtn" class="btn btn-secondary" style="padding: 0.5rem;">Save</button>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Shared League</h3>
                    <p class="settings-description">Share this link with friends to play together</p>
                    <div class="settings-group">
                        <label for="shareUrlInput">Share URL:</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="text" id="shareUrlInput" class="settings-input" readonly style="flex: 1;">
                            <button id="copyShareUrlBtn" class="btn btn-secondary" style="padding: 0.5rem;">üìã</button>
                        </div>
                    </div>
                    
                    <div class="settings-group" style="margin-top: 1.5rem;">
                        <h4>Admin Access</h4>
                        <div id="adminStatus" class="admin-status">
                            <p id="adminStatusText">Admin locked</p>
                            <div class="pin-row">
                                <label for="adminPinInput" class="sr-only">Admin PIN</label>
                                <input id="adminPinInput" class="settings-input pin-input" inputmode="numeric" pattern="\\d{4}" maxlength="4" placeholder="4-digit PIN" />
                                <button id="adminUnlockBtn" class="btn btn-primary">Unlock</button>
                            </div>
                            <div class="pin-row" id="adminPinSetupRow" style="display:none;">
                                <label for="adminPinConfirmInput" class="sr-only">Confirm Admin PIN</label>
                                <input id="adminPinConfirmInput" class="settings-input pin-input" inputmode="numeric" pattern="\\d{4}" maxlength="4" placeholder="Confirm PIN" />
                                <button id="adminSetPinBtn" class="btn btn-secondary">Set PIN</button>
                            </div>
                            <button id="adminLockBtn" class="btn btn-secondary" style="margin-top: 0.5rem; display:none;">Lock</button>
                            <button id="adminResetPinBtn" class="btn btn-secondary" style="margin-top: 0.5rem; display:none;">Reset PIN</button>
                            <p id="adminHint" class="settings-description" style="margin-top: 0.5rem; font-size: 0.85rem;">
                                Enter PIN to unlock admin actions.
                            </p>
                        </div>
                        <p class="settings-description" style="margin-top: 0.5rem; font-size: 0.85rem;">
                            Admin can edit/delete any match. Others can only edit matches from today.
                        </p>
                    </div>
                </div>
                
                <div class="settings-section" style="margin-top: 2rem;">
                    <h3>Data Management</h3>
                    <div class="button-group">
                        <button id="exportDataSettingsBtn" class="btn btn-primary">Export All Data</button>
                        <button id="importDataSettingsBtn" class="btn btn-secondary">Import Data</button>
                        <button id="clearAllDataBtn" class="btn btn-secondary" style="background-color: #f44336; margin-top: 1rem;">Clear All Data</button>
                    </div>
                    <p class="settings-description" style="margin-top: 1rem; font-size: 0.85rem; color: #f44336;">
                        Warning: Clearing all data cannot be undone. This will delete all matches, statistics, and settings.
                    </p>
                </div>
                <div class="settings-section" style="margin-top: 2rem;">
                    <h3>Debug log</h3>
                    <p class="settings-description">Errors and Sync/API events. Export to see why Sync fails on your phone.</p>
                    <div class="settings-group">
                        <textarea id="debugLogTextarea" readonly class="settings-input" rows="6" style="width: 100%; resize: vertical; font-family: monospace; font-size: 0.85rem;" placeholder="No entries yet. Try Sync Top Teams or other actions."></textarea>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                            <button type="button" id="copyDebugLogBtn" class="btn btn-secondary" style="padding: 0.5rem;">Copy log</button>
                            <button type="button" id="exportDebugLogBtn" class="btn btn-secondary" style="padding: 0.5rem;">Export as file</button>
                            <button type="button" id="clearDebugLogBtn" class="btn btn-secondary" style="padding: 0.5rem;">Clear log</button>
                        </div>
                    </div>
                </div>
                <div class="settings-section" style="margin-top: 2rem;">
                    <h3>App Version</h3>
                    <p class="settings-description">Current version of the app</p>
                    <div class="settings-group">
                        <p id="appVersionDisplay" style="font-size: 1.1rem; font-weight: 600; color: var(--primary-color); margin: 0.5rem 0;">-</p>
                        <p class="settings-description" style="font-size: 0.85rem; margin-top: 0.5rem;">
                            If the version doesn't match the latest update, tap the refresh button (üîÑ) in the header to check for updates.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="button-group" style="margin-top: 2rem;">
                <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
                <button id="backFromSettingsBtn" class="btn btn-secondary">Back</button>
            </div>
        </div>
    </section>

    <!-- Navigation -->
    <nav class="bottom-nav">
        <button class="nav-btn active" data-screen="sessionScreen">
            <span>Session</span>
        </button>
        <button class="nav-btn" data-screen="playerScreen">
            <span>Players</span>
        </button>
        <button class="nav-btn" data-screen="teamScreen">
            <span>Teams</span>
        </button>
        <button class="nav-btn" data-screen="matchScreen">
            <span>Match</span>
        </button>
        <button class="nav-btn" data-screen="statsScreen">
            <span>Stats</span>
        </button>
        <button class="nav-btn" data-screen="historyScreen">
            <span>History</span>
        </button>
        <button class="nav-btn" data-screen="settingsScreen">
            <span>Settings</span>
        </button>
    </nav>

    <!-- Hidden file input for import -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;">

    <!-- jsPDF library for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Application scripts - single ES module entry point -->
    <script type="module" src="src/app-controller.js"></script>
</body>
</html>


