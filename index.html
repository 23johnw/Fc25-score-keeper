<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2196F3">
    <meta name="description" content="FC 25 Score Tracker - Track your football match scores and statistics">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FC 25 Score Tracker</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>
    <!-- Header -->
    <header class="app-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>FC 25 Score Tracker</h1>
            <div style="display: flex; gap: 0.5rem;">
                <button id="refreshAppBtn" class="dark-mode-toggle" title="Check for Updates" style="font-size: 1rem;">üîÑ</button>
                <button id="darkModeToggle" class="dark-mode-toggle" title="Toggle Dark Mode">üåô</button>
            </div>
        </div>
        <div class="season-info" id="seasonInfo" style="display: none;">
            <span>Season <span id="currentSeasonNumber">1</span></span>
        </div>
    </header>

    <!-- Player Management Screen -->
    <section id="playerScreen" class="screen active">
        <div class="screen-content">
            <h2>Add Players</h2>
            <p class="screen-description">Enter 1-4 player names to get started</p>
            
            <div class="player-editor">
                <div class="player-editor-header">
                    <div>
                        <h3>Players</h3>
                        <p class="screen-description">Tap a name to edit. Drag to reorder. Max 4 players.</p>
                    </div>
                    <button id="addPlayerBtn" class="btn btn-secondary">Add Player</button>
                </div>
                <ul id="playerEditableList" class="player-editable-list"></ul>
            </div>

            <div class="current-players" id="currentPlayers" style="display: none;">
                <h3>Current Players</h3>
                <ul id="playersList"></ul>
            </div>

            <!-- Add this new section after current-players -->
            <div class="player-history" id="playerHistory" style="display: none;">
                <h3>Previous Players</h3>
                <p class="screen-description">Click a name to add to an empty slot</p>
                <div id="playerHistoryList" class="player-history-list"></div>
            </div>

            <div class="player-lock" id="playerLockContainer" style="display: none;">
                <h3>Home/Away Lock</h3>
                <p class="screen-description">Choose one player to always appear on Home or Away.</p>
                <div id="playerLockList" class="player-lock-list"></div>
                <p class="player-lock-hint" id="playerLockHint" style="display: none;">Set the locked player to Neutral before selecting someone else.</p>
                <p class="player-lock-hint" id="playerLockUnsavedHint" style="display: none;">Save player changes to update lock options.</p>
            </div>

            <div class="button-group">
                <button id="savePlayersBtn" class="btn btn-primary">Save Players</button>
                <button id="startNewSessionBtn" class="btn btn-secondary" style="display: none;">Start New Session</button>
            </div>
        </div>
    </section>

    <!-- Team Combination Screen -->
    <section id="teamScreen" class="screen">
        <div class="screen-content">
            <h2>Team Combinations</h2>
            <p class="screen-description" id="teamScreenDescription">Select the order you want to play these matches</p>
            
            <div id="teamCombinations" class="team-combinations-grid"></div>
            
            <div class="button-group">
                <button id="selectAllCombinationsBtn" class="btn btn-secondary">Select All</button>
                <button id="confirmSequenceBtn" class="btn btn-primary" disabled>Confirm Sequence</button>
                <button id="backToPlayersBtn" class="btn btn-secondary">Back to Players</button>
            </div>
        </div>
    </section>

    <!-- Game Sequence Screen -->
    <section id="sequenceScreen" class="screen">
        <div class="screen-content">
            <h2>Game Sequence</h2>
            <p class="screen-description">Your selected matches for tonight</p>
            
            <div id="sequenceList" class="sequence-list"></div>
            
            <div class="button-group">
                <button id="startGamesBtn" class="btn btn-primary">Start Playing</button>
                <button id="backToTeamsBtn" class="btn btn-secondary">Back to Teams</button>
            </div>
        </div>
    </section>

    <!-- Match Recording Screen -->
    <section id="matchScreen" class="screen">
        <div class="screen-content">
            <h2>Record Match</h2>
            <div class="match-info">
                <div class="game-counter">
                    <span id="currentGameNumber">1</span> / <span id="totalGames">1</span>
                </div>
                <div class="match-teams" id="matchTeams">
                    <div class="team-display">
                        <div class="team-players" id="team1Display"></div>
                        <span class="vs">VS</span>
                        <div class="team-players" id="team2Display"></div>
                    </div>
                </div>
            </div>

            <div class="match-result">
                <h3>Enter Scores</h3>
                <div class="score-input-container">
                    <div class="score-input-group">
                        <label id="team1ScoreLabel">Team 1 Score</label>
                        <input type="number" id="team1Score" min="0" max="99" value="0" class="score-input">
                    </div>
                    <span class="score-separator">-</span>
                    <div class="score-input-group">
                        <label id="team2ScoreLabel">Team 2 Score</label>
                        <input type="number" id="team2Score" min="0" max="99" value="0" class="score-input">
                    </div>
                </div>
                
                <!-- Extra Time Section -->
                <div class="extra-time-section" id="extraTimeSection" style="display: none; margin-top: 1rem;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="wentToExtraTime" class="checkbox-input">
                        <span>Went to Extra Time</span>
                    </label>
                    <p class="score-hint" style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0.5rem;">Enter the total score after extra time (full time + extra time goals)</p>
                    <div class="score-input-container" id="extraTimeScores" style="display: none; margin-top: 0.75rem;">
                        <div class="score-input-group">
                            <label>Team 1 (Total)</label>
                            <input type="number" id="team1ExtraTimeScore" min="0" max="99" value="0" class="score-input">
                        </div>
                        <span class="score-separator">-</span>
                        <div class="score-input-group">
                            <label>Team 2 (Total)</label>
                            <input type="number" id="team2ExtraTimeScore" min="0" max="99" value="0" class="score-input">
                        </div>
                    </div>
                </div>
                
                <!-- Penalties Section -->
                <div class="penalties-section" id="penaltiesSection" style="display: none; margin-top: 1rem;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="wentToPenalties" class="checkbox-input">
                        <span>Went to Penalties</span>
                    </label>
                    <p class="score-hint" style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0.5rem;">Enter only the penalties scored (e.g., 5-4)</p>
                    <div class="score-input-container" id="penaltiesScores" style="display: none; margin-top: 0.75rem;">
                        <div class="score-input-group">
                            <label>Team 1 (Pens)</label>
                            <input type="number" id="team1PenaltiesScore" min="0" max="20" value="0" class="score-input">
                        </div>
                        <span class="score-separator">-</span>
                        <div class="score-input-group">
                            <label>Team 2 (Pens)</label>
                            <input type="number" id="team2PenaltiesScore" min="0" max="20" value="0" class="score-input">
                        </div>
                    </div>
                </div>
                
                <button id="submitScoreBtn" class="btn btn-primary" style="margin-top: 1rem;">Record Score</button>
            </div>

            <div class="button-group">
                <button id="backToSequenceBtn" class="btn btn-secondary">Back to Sequence</button>
            </div>
        </div>
    </section>

    <!-- Statistics Screen -->
    <section id="statsScreen" class="screen">
        <div class="screen-content">
            <div class="stats-header">
                <h2>Statistics</h2>
                <div class="stats-tabs">
                    <button class="tab-btn active" data-tab="today">Today</button>
                    <button class="tab-btn" data-tab="season">Season</button>
                    <button class="tab-btn" data-tab="overall">Overall</button>
                </div>
                <div style="text-align: center; margin-top: 0.5rem;">
                    <button id="viewLastPDFBtn" class="btn btn-secondary" title="View Last Exported PDF" disabled style="opacity: 0.5; cursor: not-allowed;">üëÅÔ∏è View PDF</button>
                </div>
            </div>

            <div id="todayStats" class="stats-content active">
                <div class="stats-header-actions">
                    <h3>Today's Statistics</h3>
                    <div class="share-buttons-group">
                        <button id="shareTodayStatsBtn" class="btn btn-share" title="Share as Image">üì§ Share</button>
                        <button id="exportTodayPDFBtn" class="btn btn-share" title="Export as PDF">üìÑ PDF</button>
                    </div>
                </div>
                <div class="category-tabs" id="todayCategoryTabs"></div>
                <div id="todayStatsDisplay" class="stats-display"></div>
            </div>

            <div id="seasonStats" class="stats-content">
                <div class="stats-header-actions">
                    <h3>Season Statistics</h3>
                    <div class="share-buttons-group">
                        <button id="shareSeasonStatsBtn" class="btn btn-share" title="Share as Image">üì§ Share</button>
                        <button id="exportSeasonPDFBtn" class="btn btn-share" title="Export as PDF">üìÑ PDF</button>
                    </div>
                </div>
                <div class="category-tabs" id="seasonCategoryTabs"></div>
                <div id="seasonStatsDisplay" class="stats-display"></div>
            </div>

            <div id="overallStats" class="stats-content">
                <div class="stats-header-actions">
                    <h3>Overall Statistics</h3>
                    <div class="share-buttons-group">
                        <button id="shareOverallStatsBtn" class="btn btn-share" title="Share as Image">üì§ Share</button>
                        <button id="exportOverallPDFBtn" class="btn btn-share" title="Export as PDF">üìÑ PDF</button>
                    </div>
                </div>
                <div class="category-tabs" id="overallCategoryTabs"></div>
                <div id="overallStatsDisplay" class="stats-display"></div>
            </div>

            <div class="button-group">
                <button id="newSeasonBtn" class="btn btn-primary">Start New Season</button>
                <button id="exportDataBtn" class="btn btn-secondary">Export Data</button>
                <button id="importDataBtn" class="btn btn-secondary">Import Data</button>
                <button id="clearOverallStatsBtn" class="btn btn-secondary" style="background-color: #f44336;">Clear All Statistics (Testing)</button>
                <button id="backToMenuBtn" class="btn btn-secondary">Back to Menu</button>
            </div>
        </div>
    </section>

    <!-- Match History Screen -->
    <section id="historyScreen" class="screen">
        <div class="screen-content">
            <h2>Match History</h2>
            <p class="screen-description">View and manage all recorded matches</p>
            
            <div class="history-view-toggle">
                <button id="historyListViewBtn" class="view-toggle-btn active" data-view="list">üìã List</button>
                <button id="historyTimelineViewBtn" class="view-toggle-btn" data-view="timeline">üìÖ Timeline</button>
            </div>
            
            <div class="history-controls">
                <select id="historyFilter" class="filter-select">
                    <option value="all">All Seasons</option>
                    <option value="current">Current Season</option>
                    <option value="today">Today</option>
                </select>
                <input type="date" id="historyDateFrom" class="date-input" title="From Date">
                <input type="date" id="historyDateTo" class="date-input" title="To Date">
                <input type="text" id="historySearch" placeholder="Search players..." class="search-input">
                <button id="clearHistoryFiltersBtn" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem;">Clear</button>
            </div>
            
            <div id="matchHistoryList" class="match-history-list"></div>
            <div id="matchHistoryTimeline" class="match-history-timeline" style="display: none;"></div>
            
            <div class="button-group">
                <button id="backFromHistoryBtn" class="btn btn-secondary">Back</button>
            </div>
        </div>
    </section>

    <!-- Edit Match Modal -->
    <div id="editMatchModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Edit Match</h3>
            <div class="match-info">
                <div id="editMatchTeams"></div>
            </div>
            <div class="score-input-container">
                <div class="score-input-group">
                    <label>Team 1 Score</label>
                    <input type="number" id="editTeam1Score" min="0" max="99" value="0" class="score-input">
                </div>
                <span class="score-separator">-</span>
                <div class="score-input-group">
                    <label>Team 2 Score</label>
                    <input type="number" id="editTeam2Score" min="0" max="99" value="0" class="score-input">
                </div>
            </div>
            
            <!-- Extra Time Section -->
            <div class="extra-time-section" id="editExtraTimeSection" style="margin-top: 1rem;">
                <label class="checkbox-label">
                    <input type="checkbox" id="editWentToExtraTime" class="checkbox-input">
                    <span>Went to Extra Time</span>
                </label>
                <p class="score-hint" style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0.5rem;">Enter the total score after extra time (full time + extra time goals)</p>
                <div class="score-input-container" id="editExtraTimeScores" style="display: none; margin-top: 0.75rem;">
                    <div class="score-input-group">
                        <label>Team 1 (Total)</label>
                        <input type="number" id="editTeam1ExtraTimeScore" min="0" max="99" value="0" class="score-input">
                    </div>
                    <span class="score-separator">-</span>
                    <div class="score-input-group">
                        <label>Team 2 (Total)</label>
                        <input type="number" id="editTeam2ExtraTimeScore" min="0" max="99" value="0" class="score-input">
                    </div>
                </div>
            </div>
            
            <!-- Penalties Section -->
            <div class="penalties-section" id="editPenaltiesSection" style="margin-top: 1rem;">
                <label class="checkbox-label">
                    <input type="checkbox" id="editWentToPenalties" class="checkbox-input">
                    <span>Went to Penalties</span>
                </label>
                <p class="score-hint" style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0.5rem;">Enter only the penalties scored (e.g., 5-4)</p>
                <div class="score-input-container" id="editPenaltiesScores" style="display: none; margin-top: 0.75rem;">
                    <div class="score-input-group">
                        <label>Team 1 (Pens)</label>
                        <input type="number" id="editTeam1PenaltiesScore" min="0" max="20" value="0" class="score-input">
                    </div>
                    <span class="score-separator">-</span>
                    <div class="score-input-group">
                        <label>Team 2 (Pens)</label>
                        <input type="number" id="editTeam2PenaltiesScore" min="0" max="20" value="0" class="score-input">
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button id="saveEditMatchBtn" class="btn btn-primary">Save Changes</button>
                <button id="cancelEditMatchBtn" class="btn btn-secondary">Cancel</button>
                <button id="deleteMatchBtn" class="btn btn-secondary" style="background-color: #f44336;">Delete Match</button>
            </div>
        </div>
    </div>

    <!-- Settings Screen -->
    <section id="settingsScreen" class="screen">
        <div class="screen-content">
            <h2>Settings</h2>
            <p class="screen-description">Customize your score tracker</p>
            
            <div class="settings-tabs">
                <button class="settings-tab-btn active" data-settings-tab="game">Game Config</button>
                <button class="settings-tab-btn" data-settings-tab="visual">Visual</button>
                <button class="settings-tab-btn" data-settings-tab="data">Data</button>
            </div>
            
            <!-- Game Configuration Tab -->
            <div id="gameConfigTab" class="settings-tab-content active">
                <div class="settings-section">
                    <h3>Team Labels</h3>
                    <p class="settings-description">Customize the labels used for team positions</p>
                    <div class="settings-group">
                        <label for="homeLabelInput">Home Label:</label>
                        <input type="text" id="homeLabelInput" placeholder="Home" maxlength="20" class="settings-input">
                    </div>
                    <div class="settings-group">
                        <label for="awayLabelInput">Away Label:</label>
                        <input type="text" id="awayLabelInput" placeholder="Away" maxlength="20" class="settings-input">
                    </div>
                    <div class="settings-group">
                        <label for="neutralLabelInput">Neutral Label:</label>
                        <input type="text" id="neutralLabelInput" placeholder="Neutral" maxlength="20" class="settings-input">
                    </div>
                    <button id="resetLabelsBtn" class="btn btn-secondary" style="margin-top: 1rem;">Reset to Default</button>
                </div>
            </div>
            
            <!-- Visual Settings Tab -->
            <div id="visualSettingsTab" class="settings-tab-content">
                <div class="settings-section">
                    <h3>Player Colors</h3>
                    <p class="settings-description">Assign colors to players for visual identification</p>
                    <div id="playerColorsList" class="player-colors-list"></div>
                </div>
                <div class="settings-section" style="margin-top: 2rem;">
                    <h3>Theme</h3>
                    <div class="settings-group">
                        <label>
                            <input type="checkbox" id="darkModeSetting" class="settings-checkbox">
                            Enable Dark Mode
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Data Management Tab -->
            <div id="dataSettingsTab" class="settings-tab-content">
                <div class="settings-section">
                    <h3>Data Management</h3>
                    <div class="button-group">
                        <button id="exportDataSettingsBtn" class="btn btn-primary">Export All Data</button>
                        <button id="importDataSettingsBtn" class="btn btn-secondary">Import Data</button>
                        <button id="clearAllDataBtn" class="btn btn-secondary" style="background-color: #f44336; margin-top: 1rem;">Clear All Data</button>
                    </div>
                    <p class="settings-description" style="margin-top: 1rem; font-size: 0.85rem; color: #f44336;">
                        Warning: Clearing all data cannot be undone. This will delete all matches, statistics, and settings.
                    </p>
                </div>
                <div class="settings-section" style="margin-top: 2rem;">
                    <h3>App Version</h3>
                    <p class="settings-description">Current version of the app</p>
                    <div class="settings-group">
                        <p id="appVersionDisplay" style="font-size: 1.1rem; font-weight: 600; color: var(--primary-color); margin: 0.5rem 0;">-</p>
                        <p class="settings-description" style="font-size: 0.85rem; margin-top: 0.5rem;">
                            If the version doesn't match the latest update, tap the refresh button (üîÑ) in the header to check for updates.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="button-group" style="margin-top: 2rem;">
                <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
                <button id="backFromSettingsBtn" class="btn btn-secondary">Back</button>
            </div>
        </div>
    </section>

    <!-- Navigation -->
    <nav class="bottom-nav">
        <button class="nav-btn" data-screen="playerScreen">
            <span>Players</span>
        </button>
        <button class="nav-btn" data-screen="teamScreen">
            <span>Teams</span>
        </button>
        <button class="nav-btn" data-screen="matchScreen">
            <span>Match</span>
        </button>
        <button class="nav-btn" data-screen="statsScreen">
            <span>Stats</span>
        </button>
        <button class="nav-btn" data-screen="historyScreen">
            <span>History</span>
        </button>
        <button class="nav-btn" data-screen="settingsScreen">
            <span>Settings</span>
        </button>
    </nav>

    <!-- Hidden file input for import -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;">

    <!-- jsPDF library for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script src="app.js"></script>
</body>
</html>


